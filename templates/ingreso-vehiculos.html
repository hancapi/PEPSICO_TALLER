{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ingreso Veh√≠culos - Taller PepsiCo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
  <!-- BARRA LATERAL -->
  <div class="sidebar">
    <div class="p-3 text-center border-bottom">
      <h5>üöó Taller PepsiCo Chile</h5>
    </div>
    <nav class="nav flex-column">
      <a class="nav-link" href="{% url 'inicio' %}">üè† Inicio</a>
      <a class="nav-link active" href="{% url 'vehiculos:ingreso_vehiculos' %}">üöó Ingreso Veh√≠culos</a>
      <a class="nav-link" href="{% url 'reportes:reportes' %}">üìä Reportes</a>
      <a class="nav-link" href="#">üí¨ Chat</a>
    </nav>
  </div>

  <!-- CONTENIDO PRINCIPAL -->
  <div class="main-content">
    <div class="row mb-4">
      <div class="col-12 text-end">
        <button class="btn btn-outline-danger" id="logoutButton">üîí Cerrar Sesi√≥n</button>
        <span id="envIndicator"></span>
      </div>
    </div>

    <div class="page-header">
      <h1>Registrar Ingreso</h1>
      <p class="mb-0">Sistema de ingreso de veh√≠culos al taller - Evite solapamientos</p>
    </div>

    <!-- ESTAD√çSTICAS -->
    <div class="row mb-4">
      <div class="col-md-3"><div class="stats-card"><div class="stat-number">{{ total_vehiculos }}</div><div class="stat-label">Veh√≠culos Totales</div></div></div>
      <div class="col-md-3"><div class="stats-card"><div class="stat-number">{{ en_taller }}</div><div class="stat-label">En Taller</div></div></div>
      <div class="col-md-3"><div class="stats-card"><div class="stat-number">{{ en_proceso }}</div><div class="stat-label">En Proceso</div></div></div>
      <div class="col-md-3"><div class="stats-card"><div class="stat-number">{{ disponibles }}</div><div class="stat-label">Disponibles</div></div></div>
    </div>

    <!-- ALERTAS -->
    <div id="successAlert" class="alert alert-success d-none" role="alert"></div>
    <div id="errorAlert" class="alert alert-danger d-none" role="alert"></div>

    <!-- FORMULARIO -->
    <div class="card form-card mt-4">
      <div class="card-body">
        <h5 class="card-title mb-3 required-field">Datos del Veh√≠culo</h5>
        <form id="ingresoForm">
          
          <!-- Patente -->
          <div class="mb-3">
            <label for="patente" class="form-label required-field">Patente Veh√≠culo</label>
            <input type="text" class="form-control" id="patente" maxlength="8" required>
          </div>

          <!-- üîπ Datos del Veh√≠culo (NUEVO) -->
          <div id="formNuevoVehiculo" class="d-none">
            <hr>
            <h6>Datos del Veh√≠culo Nuevo</h6>
            <div class="mb-3">
              <label for="marca" class="form-label">Marca</label>
              <input type="text" class="form-control" id="marca">
            </div>
            <div class="mb-3">
              <label for="modelo" class="form-label">Modelo</label>
              <input type="text" class="form-control" id="modelo">
            </div>
            <div class="mb-3">
              <label for="anio" class="form-label">A√±o</label>
              <input type="number" class="form-control" id="anio" min="1900" max="2099">
            </div>
            <div class="mb-3">
              <label for="tipo" class="form-label">Tipo Veh√≠culo</label>
              <input type="text" class="form-control" id="tipo">
            </div>
          </div>

          <!-- Taller -->
          <div class="mb-3">
            <label for="ubicacion" class="form-label required-field">Seleccione un taller</label>
            <select class="form-select" id="ubicacion" required>
              {% for taller in talleres %}
                <option value="{{ taller.taller_id }}">{{ taller.nombre }} - {{ taller.ubicacion }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Tipo de Mantenimiento -->
          <div class="mb-3">
            <label for="tipoMantenimiento" class="form-label required-field">Tipo Mantenimiento</label>
            <select class="form-select" id="tipoMantenimiento" required>
              <option value="">Selecciona tipo</option>
              <option value="preventivo">Preventivo</option>
              <option value="correctivo">Correctivo</option>
            </select>
          </div>

          <!-- Kilometraje -->
          <div class="mb-3">
            <label for="kilometraje" class="form-label required-field">Kilometraje</label>
            <input type="number" class="form-control" id="kilometraje" min="0" required>
          </div>

          <!-- Estado -->
          <div class="mb-3">
            <label for="descripcion" class="form-label">Estado Veh√≠culo</label>
            <textarea class="form-control" id="descripcion" rows="4"></textarea>
          </div>

          <!-- RUT Chofer -->
          <div class="mb-3">
            <label for="rut" class="form-label required-field">RUT Chofer</label>
            <input type="text" class="form-control" id="rut" maxlength="12" required>
          </div>

          <!-- Datos del Chofer (NUEVO) -->
          <div id="datosChoferNuevo" style="display: none;">
            <hr>
            <h6>Datos del Chofer Nuevo</h6>
            
            <input type="hidden" id="rutChoferNuevo">

            <div class="mb-3">
              <label for="nombreChofer" class="form-label required-field">Nombre Completo</label>
              <input type="text" class="form-control" id="nombreChofer">
            </div>

            <div class="mb-3">
              <label for="cargoChofer" class="form-label">Cargo</label>
              <input type="text" class="form-control" id="cargoChofer" value="CHOFER" readonly style="background-color: #f8f9fa;">
              <small class="text-muted">Cargo predefinido como Chofer</small>
            </div>

            <div class="mb-3">
              <label for="regionChofer" class="form-label">Regi√≥n</label>
              <select class="form-select" id="regionChofer">
                <option value="">Seleccione regi√≥n</option>
                {% for value, label in form.fields.region.choices %}
                  <option value="{{ value }}">{{ label }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="mb-3">
              <label for="horarioChofer" class="form-label">Horario</label>
              <select class="form-select" id="horarioChofer">
                <option value="">Seleccione horario</option>
                {% for value, label in form.fields.horario.choices %}
                  <option value="{{ value }}">{{ label }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="mb-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="disponibleChofer" checked>
                <label class="form-check-label" for="disponibleChofer">
                  Disponible
                </label>
              </div>
            </div>

            <div class="mb-3">
              <label for="usuarioChofer" class="form-label required-field">Usuario</label>
              <input type="text" class="form-control" id="usuarioChofer">
            </div>

            <div class="mb-3">
              <label for="passwordChofer" class="form-label required-field">Contrase√±a</label>
              <input type="password" class="form-control" id="passwordChofer" placeholder="M√≠nimo 6 caracteres">
            </div>

            <button type="button" id="registrarChoferBtn" class="btn btn-success mb-3">
              Registrar Nuevo Chofer
            </button>
          </div>

          <!-- Calendario y Horarios -->
          <div class="mb-4">
            <label class="form-label required-field">Seleccione Fecha y Hora</label>
            <div class="card">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <button class="btn btn-outline-secondary" onclick="previousMonth()">‚Äπ</button>
                  <h5 id="currentMonth" class="mb-0"></h5>
                  <button class="btn btn-outline-secondary" onclick="nextMonth()">‚Ä∫</button>
                </div>
                <div id="calendar" class="calendar-grid mb-3"></div>
                <div id="timeSlots" class="time-slots"></div>
                <div id="scheduleSummary" class="alert alert-info mt-3" style="display: none;">
                  <strong>Horario seleccionado:</strong> <span id="selectedSchedule"></span>
                </div>
              </div>
            </div>
            <input type="hidden" id="fechaSeleccionada">
            <input type="hidden" id="horaSeleccionada">
          </div>

          <div class="d-grid">
            <button type="submit" class="btn btn-primary btn-lg">Agendar Ingreso</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="{% static 'js/ingreso_vehiculos.js' %}"></script>
  <script src="{% static 'js/auth.js' %}"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
