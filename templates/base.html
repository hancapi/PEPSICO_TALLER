{% load static %}
{% load roles %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>{% block title %}Taller PepsiCo Chile{% endblock %}</title>

    <!-- Bootstrap -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

    <!-- CSS Global -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

<body>

    <!-- HEADER MOBILE -->
    <div class="mobile-header">
        <button id="toggleSidebar" class="btn btn-light">
            ‚ò∞
        </button>
        <strong class="ms-2">üöó Taller PepsiCo</strong>
    </div>

    <!-- SIDEBAR (partial) -->
    {% include "partials/sidebar.html" %}

    <!-- TOPBAR -->
    <div class="topbar">
        <span id="envIndicator" class="env-indicator">Entorno local</span>

        <!-- üîô Bot√≥n gen√©rico de volver -->
        <button id="backButton"
                type="button"
                class="btn btn-outline-secondary btn-sm ms-3"
                onclick="handleBackClick()">
            ‚Üê Volver
        </button>

        <a href="{% url 'autenticacion:logout-web' %}"
           id="logoutButton"
           class="btn btn-outline-danger btn-sm ms-3">
            Cerrar Sesi√≥n
        </a>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">
        {% block content %}{% endblock %}
    </div>

    <!-- SCRIPTS -->
    <script>
        // Toggle sidebar en mobile
        document.getElementById("toggleSidebar")?.addEventListener("click", () => {
            const sb = document.querySelector(".sidebar");
            if (sb) sb.classList.toggle("sidebar-open");
        });

        // üîô L√≥gica del bot√≥n "Volver"
        function handleBackClick() {
            // Si hay historial previo, volvemos; si no, vamos al dashboard
            if (window.history.length > 1) {
                window.history.back();
            } else {
                window.location.href = "{% url 'inicio' %}";
            }
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
