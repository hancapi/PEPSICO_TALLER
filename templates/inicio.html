{% extends "base.html" %}
{% load static %}
{% load roles %}

{% block title %}Inicio | Taller PepsiCo Chile{% endblock %}

{% block content %}
<div class="page-container fade-in">

    <!-- ======================================================
         TARJETA DE BIENVENIDA
    ====================================================== -->
    <div class="welcome-card mb-4">
        <div class="welcome-content">
            <div class="welcome-avatar">{{ empleado.nombre|first|upper }}</div>

            <div class="welcome-text">
                <h1 class="mb-1">Bienvenido, {{ empleado.nombre }}</h1>
                <p class="m-0">Sistema de Gesti√≥n de Veh√≠culos ‚Äî <strong>Taller PepsiCo Chile</strong></p>
            </div>
        </div>
    </div>

    <!-- ======================================================
         INFORMACI√ìN DEL EMPLEADO
    ====================================================== -->
    <div class="card info-empleado-card mb-4">
        <div class="row">

            <div class="col-md-6 mb-3">
                <h5 class="fw-bold mb-3">üßë‚Äçüíº Mi Informaci√≥n</h5>

                <p class="mb-1"><strong>RUT:</strong> {{ empleado.rut }}</p>
                <p class="mb-1"><strong>Cargo:</strong> {{ empleado.cargo }}</p>
            </div>

            <div class="col-md-6">
                <p class="mb-1"><strong>Horario:</strong> {{ empleado.horario }}</p>
                <p class="mb-1"><strong>Regi√≥n:</strong> {{ empleado.region }}</p>
                <p class="mb-1"><strong>Taller:</strong> {{ empleado.taller.nombre }}</p>
            </div>

        </div>
    </div>

    <!-- ======================================================
         KPIS (solo supervisor)
    ====================================================== -->
    {% if empleado.cargo|upper == "SUPERVISOR" %}
    <div class="stats-section mb-4">

        <div class="stats-card">
            <div class="stat-number" id="statVehiculos">{{ kpis.total_vehiculos }}</div>
            <div class="stat-label">Veh√≠culos Totales</div>
        </div>

        <div class="stats-card">
            <div class="stat-number text-pastel-red" id="statTaller">{{ kpis.en_taller }}</div>
            <div class="stat-label">En Taller</div>
        </div>

        <div class="stats-card">
            <div class="stat-number" id="statProceso">{{ kpis.en_proceso }}</div>
            <div class="stat-label">En Proceso</div>
        </div>

        <div class="stats-card">
            <div class="stat-number" id="statEmpleados">{{ kpis.total_empleados }}</div>
            <div class="stat-label">Empleados Activos</div>
        </div>

    </div>
    {% endif %}

    <!-- ======================================================
         TARJETAS DE ACCESO R√ÅPIDO
    ====================================================== -->
    <div class="features-section">

        <!-- üîµ Asignaci√≥n Taller (solo supervisor) -->
        {% if empleado.cargo|upper == "SUPERVISOR" %}
        <div class="card feature-card">
            <div class="card-body">
                <h5 class="fw-bold">üß∞ Asignaci√≥n Taller</h5>
                <p class="text-muted">Asignar mec√°nicos a veh√≠culos con OT pendiente.</p>
                <a href="{% url 'asignacion-taller' %}" class="btn btn-outline-primary w-100">
                    Abrir Asignaci√≥n
                </a>
            </div>
        </div>
        {% endif %}

        <!-- üõ† Registro Taller (supervisor/mec√°nico) -->
        {% if empleado.cargo|upper == "SUPERVISOR" or empleado.cargo|upper == "MECANICO" %}
        <div class="card feature-card">
            <div class="card-body">
                <h5 class="fw-bold">üõ†Ô∏è Registro Taller</h5>
                <p class="text-muted">Gestiona y visualiza todos los veh√≠culos en el taller.</p>
                <a href="{% url 'registro-taller' %}" class="btn btn-outline-primary w-100">
                    Ingresar
                </a>
            </div>
        </div>
        {% endif %}

        <!-- üöó Ingreso de veh√≠culos -->
        {% if empleado.cargo|upper == "CHOFER" or empleado.cargo|upper == "SUPERVISOR" %}
        <div class="card feature-card">
            <div class="card-body">
                <h5 class="fw-bold">üöó Ingreso Veh√≠culos</h5>
                <p class="text-muted">Registra ingresos y agenda revisiones.</p>
                <a href="{% url 'ingreso-vehiculos' %}" class="btn btn-outline-primary w-100">
                    Ingresar
                </a>
            </div>
        </div>
        {% endif %}

        <!-- üìÑ Ficha Veh√≠culo -->
        <div class="card feature-card">
            <div class="card-body">
                <h5 class="fw-bold">üìÑ Ficha Veh√≠culo</h5>
                <p class="text-muted">Consulta historial, OT y KPIs del veh√≠culo.</p>
                <a href="{% url 'ficha-vehiculo' %}" class="btn btn-outline-primary w-100">
                    Abrir Ficha
                </a>
            </div>
        </div>

        <!-- üìä Reportes -->
        {% if empleado.cargo|upper == "SUPERVISOR" %}
        <div class="card feature-card">
            <div class="card-body">
                <h5 class="fw-bold">üìä Reportes</h5>
                <p class="text-muted">M√©tricas y an√°lisis de operaciones.</p>
                <a href="{% url 'reportes-dashboard' %}" class="btn btn-outline-primary w-100">
                    Ver Reportes
                </a>
            </div>
        </div>
        {% endif %}

    </div>

</div>

<!-- Script de KPIs -->
<script src="{% static 'js/dashboard.js' %}"></script>

{% endblock %}
