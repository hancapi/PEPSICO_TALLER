{# templates/admin_empleados.html #}
{% extends "base.html" %}
{% load static %}
{% load roles %}

{% block title %}Gesti√≥n de Empleados | Taller PepsiCo Chile{% endblock %}

{% block content %}
<div class="page-container fade-in">

  <!-- ENCABEZADO -->
  <div class="welcome-card mb-4">
    <div class="welcome-content">
      <div class="welcome-avatar">üßë‚Äçüíº</div>
      <div class="welcome-text">
        <h1>Gesti√≥n de Empleados</h1>
        <p>Alta, baja y modificaci√≥n de empleados del sistema.</p>
      </div>
    </div>

    <div class="mt-3 text-end">
      <!-- Bot√≥n NUEVO EMPLEADO -->
      <a href="{% url 'autenticacion:admin-web-empleado-nuevo' %}"
         class="btn btn-primary">
        + Nuevo Empleado
      </a>
    </div>
  </div>

  <!-- FILTROS -->
  <div class="card mb-3">
    <div class="card-body">
      <h5 class="fw-bold mb-3">üéõÔ∏è Filtros</h5>

      <form method="get" class="row g-3 align-items-end">
        <div class="col-md-3">
          <label class="form-label" for="fltRut">RUT</label>
          <input type="text"
                 id="fltRut"
                 name="rut"
                 class="form-control"
                 value="{{ f_rut }}"
                 placeholder="Ej: 11111111-1">
        </div>

        <div class="col-md-3">
          <label class="form-label" for="fltNombre">Nombre</label>
          <input type="text"
                 id="fltNombre"
                 name="nombre"
                 class="form-control"
                 value="{{ f_nombre }}"
                 placeholder="Nombre o parte">
        </div>

        <div class="col-md-3">
          <label class="form-label" for="fltCargo">Cargo</label>
          <select id="fltCargo"
                  name="cargo"
                  class="form-select">
            <option value="">Todos</option>
            {% for c in cargos %}
              <option value="{{ c }}" {% if f_cargo == c %}selected{% endif %}>
                {{ c }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-3">
          <label class="form-label" for="fltRegion">Regi√≥n</label>
          <select id="fltRegion"
                  name="region"
                  class="form-select">
            <option value="">Todas</option>
            {% for r in regiones %}
              <option value="{{ r }}" {% if f_region == r %}selected{% endif %}>
                {{ r }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-12 mt-3 d-flex gap-2">
          <button type="submit" class="btn btn-primary">
            üîé Aplicar filtros
          </button>
          <a href="{% url 'autenticacion:admin-web-empleados' %}"
             class="btn btn-outline-secondary">
            üßπ Limpiar
          </a>
        </div>
      </form>
    </div>
  </div>

  <!-- TABLA -->
  <div class="card">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="fw-bold mb-0">Empleados</h5>
        <span class="text-muted small">
          {{ empleados|length }} registro(s)
        </span>
      </div>

      <div class="table-responsive">
        <table class="table table-sm table-hover align-middle">
          <thead>
            <tr>
              <th>RUT</th>
              <th>Usuario</th>
              <th>Nombre</th>
              <th>Cargo</th>
              <th>Regi√≥n</th>
              <th>Recinto</th>
              <th>Activo</th>
              <th class="text-end">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% if empleados %}
              {% for e in empleados %}
                <tr>
                  <td>{{ e.rut }}</td>
                  <td>{{ e.usuario }}</td>
                  <td>{{ e.nombre }}</td>
                  <td>{{ e.cargo }}</td>
                  <td>{{ e.region }}</td>
                  <td>{{ e.recinto }}</td>
                  <td>
                    {% if e.is_active %}
                      <span class="badge bg-success">S√≠</span>
                    {% else %}
                      <span class="badge bg-secondary">No</span>
                    {% endif %}
                  </td>
                  <td class="text-end">
                    <!-- Editar -->
                    <a href="{% url 'autenticacion:admin-web-empleado-editar' e.rut %}"
                       class="btn btn-sm btn-outline-secondary me-1">
                      Editar
                    </a>

                    <!-- Eliminar -->
                    <a href="{% url 'autenticacion:admin-web-empleado-eliminar' e.rut %}"
                       class="btn btn-sm btn-outline-danger">
                      Eliminar
                    </a>
                  </td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="8" class="text-muted text-center">
                  No se encontraron empleados con los filtros actuales.
                </td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
{% endblock %}
