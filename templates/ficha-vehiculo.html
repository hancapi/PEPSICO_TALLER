{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Ficha de VehÃ­culo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="{% static 'css/style.css' %}"/>
</head>
<body>
  {% include "partials/sidebar.html" with menu_active="ingreso" %}

  <div class="main-content p-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="mb-0">ðŸ“„ Ficha de VehÃ­culo</h1>
      <form class="d-flex gap-2" id="formBuscar">
        <input class="form-control" id="patenteInput" placeholder="Patente (p.e. ABCZ12)" value="{{ patente|default:'' }}">
        <button class="btn btn-primary" type="submit">Buscar</button>
      </form>
    </div>

    <!-- Encabezado / info vehÃ­culo -->
    <div class="card mb-3">
      <div class="card-body">
        <div id="vehiculoNoEncontrado" class="alert alert-warning d-none mb-3">No se encontrÃ³ la patente indicada.</div>
        <div class="row g-3" id="vehiculoInfo" style="display:none;">
          <div class="col-md-3">
            <div class="small text-muted">Patente</div>
            <div class="fw-semibold" id="v_patente">â€”</div>
          </div>
          <div class="col-md-3">
            <div class="small text-muted">Marca / Modelo</div>
            <div class="fw-semibold" id="v_marca_modelo">â€”</div>
          </div>
          <div class="col-md-2">
            <div class="small text-muted">AÃ±o</div>
            <div class="fw-semibold" id="v_anio">â€”</div>
          </div>
          <div class="col-md-2">
            <div class="small text-muted">Tipo</div>
            <div class="fw-semibold" id="v_tipo">â€”</div>
          </div>
          <div class="col-md-2">
            <div class="small text-muted">UbicaciÃ³n</div>
            <div class="fw-semibold" id="v_ubicacion">â€”</div>
          </div>
          <div class="col-md-2">
            <div class="small text-muted">Estado</div>
            <span class="badge bg-secondary" id="v_estado">â€”</span>
          </div>
        </div>
      </div>
    </div>

    <!-- KPIs + OT actual -->
    <div class="row g-3 mb-3">
      <div class="col-md-3">
        <div class="stats-card">
          <div class="stat-number" id="kpi_ots">0</div>
          <div class="stat-label">OTs totales</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stats-card">
          <div class="stat-number" id="kpi_incidentes">0</div>
          <div class="stat-label">Incidentes</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stats-card">
          <div class="stat-number" id="kpi_prestamos">0</div>
          <div class="stat-label">PrÃ©stamos</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stats-card">
          <div class="stat-number" id="kpi_llave">â€”</div>
          <div class="stat-label">Llave</div>
        </div>
      </div>
    </div>

    <div class="card mb-4" id="otActualCard" style="display:none;">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <h5 class="mb-1">ðŸŸ¢ OT en curso</h5>
          <div class="small text-muted" id="otActualMeta">â€”</div>
        </div>
        <span class="badge bg-info" id="otActualEstado">â€”</span>
      </div>
    </div>

    <!-- Historial OTs -->
    <div class="card">
      <div class="card-body">
        <div class="d-flex flex-wrap gap-2 align-items-end mb-3">
          <div>
            <label class="form-label">Desde</label>
            <input type="date" class="form-control" id="fromDate">
          </div>
          <div>
            <label class="form-label">Hasta</label>
            <input type="date" class="form-control" id="toDate">
          </div>
          <div>
            <label class="form-label">Estado</label>
            <select class="form-select" id="fltEstado">
              <option value="">(Todos)</option>
              <option>Pendiente</option>
              <option>En Proceso</option>
              <option>Finalizado</option>
              <option>Cancelado</option>
            </select>
          </div>
          <div>
            <label class="form-label">Taller (ID o nombre)</label>
            <input class="form-control" id="fltTaller" placeholder="1 / MaipÃº">
          </div>
          <button class="btn btn-outline-primary" id="btnFiltrar">Aplicar</button>
          <button class="btn btn-outline-secondary" id="btnLimpiar">Limpiar</button>
          <div class="ms-auto small text-muted" id="tablaCount"></div>
        </div>

        <div class="table-responsive">
          <table class="table table-sm table-striped align-middle">
            <thead>
              <tr>
                <th>#OT</th>
                <th>Fecha/Hora</th>
                <th>Taller</th>
                <th>Estado</th>
                <th>Responsable</th>
                <th>Creador</th>
              </tr>
            </thead>
            <tbody id="tablaOtsBody">
              <tr><td colspan="6" class="text-muted">Cargandoâ€¦</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script src="{% static 'js/ficha_vehiculo.js' %}"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

